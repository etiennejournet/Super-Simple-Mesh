apiVersion: apps/v1
kind: Deployment
metadata:
  name: test-simple-mtls-connection
  labels:
    app: test-simple-mtls-connection
spec:
  replicas: 1
  selector:
    matchLabels:
      app: test-simple-mtls-connection
  template:
    metadata:
      labels:
        app: test-simple-mtls-connection
      annotations:
        cert-manager.ssm.io/service-name: "test-simple-mtls-connection.default.svc.cluster.local"
    spec:
      containers:
      - name: alpine
        image: alpine:latest
        command: ["/bin/sh", "-c"]
        args: |
          echo "Test external connection"
          wget -qO- -t3 google.fr || exit 1
          echo "Test connection to nginx service on http port"
          wget -qO- -T3 nginx.default.svc.cluster.local || exit 1
          echo "Test connection to nginx service on 8000 port"
          wget -qO- -T3 nginx-different-port.default.svc.cluster.local:8000 || exit 1
        ports:
        - containerPort: 80
